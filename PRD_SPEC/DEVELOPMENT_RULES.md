# 上海中考择校系统开发规则

## 1. 技术一致性规则

### 1.1 后端接口规则

#### 1.1.1 API路径规范
- **基础路径**：所有API路径必须以 `/api/v1` 开头
- **插件路径**：插件API路径格式为 `/api/v1/plugins/{plugin}/{...path}`
- **HTTP方法**：严格遵循RESTful设计原则
  - `GET`：获取资源
  - `POST`：创建资源
  - `PUT`：更新资源
  - `DELETE`：删除资源
- **路径命名**：使用小写字母和连字符（-），避免下划线和驼峰命名

#### 1.1.2 请求和响应格式
- **请求体**：使用JSON格式，字段名使用驼峰命名
- **响应格式**：
  - 成功响应：`{"data": {...}, "message": "Success"}`
  - 错误响应：`{"error": {"code": 4001, "message": "认证失败", "details": "无效的访问令牌", "timestamp": "2026-01-28T12:00:00Z"}}`
- **状态码**：
  - `200 OK`：成功
  - `201 Created`：资源创建成功
  - `400 Bad Request`：请求参数错误
  - `401 Unauthorized`：认证失败
  - `403 Forbidden`：权限不足
  - `404 Not Found`：资源不存在
  - `500 Internal Server Error`：服务器内部错误
  - `429 Too Many Requests`：请求过于频繁

#### 1.1.3 认证和授权
- **认证方式**：使用JWT令牌认证
- **请求头**：在请求头中添加 `Authorization: Bearer {token}`
- **权限控制**：基于角色的访问控制，区分普通用户和管理员
- **速率限制**：遵循设计文档中定义的速率限制规则

### 1.2 前端组件规则

#### 1.2.1 组件命名规范
- **组件名**：使用PascalCase命名（如 `SchoolCard`）
- **文件命名**：组件文件名与组件名保持一致（如 `SchoolCard.tsx`）
- **目录结构**：
  - 原子组件：`components/ui/`
  - 分子组件：`components/molecules/`
  - 组织组件：`components/organisms/`
  - 页面组件：`app/{page}/page.tsx`

#### 1.2.2 组件设计原则
- **单一职责**：每个组件只负责一个特定的功能
- **可复用性**：设计可复用的组件，避免重复代码
- **可测试性**：组件设计应便于单元测试
- **类型安全**：使用TypeScript类型定义，确保类型安全

#### 1.2.3 状态管理
- **全局状态**：使用React Context API管理全局状态
- **局部状态**：使用React的useState和useReducer管理组件局部状态
- **数据获取**：使用React Query进行数据获取和缓存
- **状态更新**：遵循不可变性原则，使用函数式更新

### 1.3 架构一致性规则

#### 1.3.1 插件化架构
- **核心模块**：包含认证、插件管理等基础功能
- **插件模块**：包含业务功能，如学校管理、模考记录、评估分析等
- **插件接口**：统一的插件注册和加载机制
- **插件隔离**：插件之间相互独立，通过核心模块进行通信

#### 1.3.2 目录结构
- **前端目录**：
  ```
  frontend/
    ├── app/              # Next.js应用
    ├── components/       # 组件
    ├── core/             # 核心模块
    ├── plugins/          # 插件模块
    ├── lib/              # 工具库
    ├── hooks/            # 自定义Hooks
    ├── public/           # 静态资源
    ├── styles/           # 全局样式
  ```
- **后端目录**：
  ```
  frontend/app/api/       # Next.js API Routes
  frontend/core/api/      # 核心API
  frontend/plugins/*/backend/ # 插件后端逻辑
  ```

#### 1.3.3 数据库设计
- **ORM**：使用Prisma作为ORM框架
- **表结构**：严格遵循设计文档中的表结构设计
- **索引**：按照设计文档中的索引设计创建索引
- **关系**：确保数据库关系的正确性和完整性

## 2. 用户体验一致性规则

### 2.1 视觉设计规则

#### 2.1.1 设计系统
- **UI库**：使用Shadcn/ui作为基础UI库
- **颜色方案**：
  - 主色：#3b82f6（蓝色）
  - 辅助色：#10b981（绿色）、#ef4444（红色）
  - 中性色：#f3f4f6（浅灰）、#6b7280（中灰）、#1f2937（深灰）
- **字体**：
  - 标题：Inter, sans-serif
  - 正文：Inter, sans-serif
  - 字体大小：遵循Tailwind CSS的默认字体大小

#### 2.1.2 响应式设计
- **断点**：使用Tailwind CSS的默认断点
  - sm: 640px
  - md: 768px
  - lg: 1024px
  - xl: 1280px
  - 2xl: 1536px
- **布局**：在不同屏幕尺寸下保持布局的一致性和可用性
- **交互**：确保在触摸设备上的交互体验良好

### 2.2 交互设计规则

#### 2.2.1 表单处理
- **验证**：使用React Hook Form进行表单验证
- **错误提示**：实时显示表单验证错误，位置在输入字段下方
- **提交反馈**：提交表单时显示加载状态，提交成功后显示成功提示

#### 2.2.2 导航和路由
- **导航结构**：左侧侧边栏导航，包含主要功能模块
- **路由过渡**：使用Next.js的内置路由过渡效果
- **认证重定向**：未登录用户访问需要认证的页面时，自动重定向到登录页面

#### 2.2.3 加载和错误状态
- **加载状态**：使用骨架屏或加载动画显示加载状态
- **错误状态**：统一的错误信息展示，包含错误代码和详细信息
- **空状态**：当数据为空时，显示友好的空状态提示

### 2.3 性能体验规则

#### 2.3.1 页面加载
- **首屏加载**：使用Next.js的服务器端渲染，确保首屏快速加载
- **代码分割**：使用动态导入实现组件级别的代码分割
- **静态资源**：使用CDN加速静态资源加载

#### 2.3.2 数据缓存
- **缓存策略**：遵循设计文档中的缓存策略
- **缓存预热**：在应用启动时预加载常用数据
- **缓存监控**：实现缓存使用情况的监控

## 3. 开发流程规则

### 3.1 开发环境设置
- **环境变量**：使用.env.local文件存储本地环境变量
- **依赖管理**：使用npm或yarn管理依赖
- **开发服务器**：使用Next.js的开发服务器（npm run dev）

### 3.2 版本控制
- **Git工作流**：
  - main：主分支，用于生产环境
  - develop：开发分支，用于集成测试
  - feature/{feature-name}：特性分支，用于开发新功能
  - fix/{bug-name}：修复分支，用于修复bug
- **提交规范**：
  - 格式：`type(scope): subject`
  - 类型：feat（新功能）、fix（修复）、docs（文档）、style（样式）、refactor（重构）、test（测试）、chore（构建/依赖）
  - 示例：`feat(auth): 添加双因素认证功能`

### 3.3 代码审查
- **审查流程**：
  1. 开发者创建Pull Request
  2. 自动运行测试和代码质量检查
  3. 团队成员进行代码审查
  4. 审查通过后合并到目标分支
- **审查要点**：
  - 代码质量和可读性
  - 类型安全
  - 性能优化
  - 安全性
  - 遵循开发规则

### 3.4 测试策略
- **单元测试**：使用Jest测试框架，测试核心功能和组件
- **集成测试**：测试前后端集成、数据库集成
- **端到端测试**：使用Cypress测试关键用户流程
- **测试覆盖率**：目标覆盖率不低于80%

## 4. 部署和维护规则

### 4.1 部署流程
- **传统服务器部署**：
  1. 构建应用：`npm run build`
  2. 启动应用：`pm2 start npm --name "shanghai-high-school-admission" -- run start`
  3. 配置Nginx：设置反向代理
- **Vercel云部署**：
  1. 连接GitHub仓库
  2. 配置环境变量
  3. 自动部署
- **移动应用打包**：
  1. 构建应用：`npm run build`
  2. 同步Capacitor：`npx cap sync`
  3. 打开平台：`npx cap open ios` 或 `npx cap open android`
  4. 构建和发布应用

### 4.2 监控和告警
- **应用监控**：使用New Relic或Datadog监控应用性能
- **错误监控**：使用Sentry监控错误
- **告警机制**：当错误率或响应时间超过阈值时，发送告警
- **日志管理**：使用ELK Stack或类似工具管理日志

### 4.3 安全更新
- **依赖更新**：定期更新依赖，修复安全漏洞
- **安全扫描**：使用npm audit或类似工具进行安全扫描
- **认证机制**：定期审查认证机制，确保安全性
- **数据保护**：确保敏感数据的加密存储和传输

## 5. 文档规则

### 5.1 代码文档
- **注释规范**：
  - 函数注释：使用JSDoc格式
  - 复杂逻辑注释：添加详细的注释说明
  - 类型定义：使用TypeScript类型定义，替代注释
- **组件文档**：使用Storybook记录组件的使用方法和示例

### 5.2 API文档
- **文档格式**：使用Swagger或OpenAPI规范
- **文档内容**：
  - API路径和方法
  - 请求参数和请求体
  - 响应格式和状态码
  - 认证要求和速率限制
- **文档更新**：API变更时，及时更新文档

### 5.3 开发文档
- **架构文档**：系统架构设计和组件关系
- **部署文档**：不同部署环境的配置和部署步骤
- **开发指南**：新开发者的入门指南
- **故障排查**：常见问题和解决方案

## 6. AI开发特别规则

### 6.1 代码生成规则
- **代码风格**：遵循项目的代码风格规范
- **类型安全**：确保所有代码都有正确的TypeScript类型定义
- **错误处理**：实现全面的错误处理，包括边界情况
- **测试覆盖**：为生成的代码编写单元测试

### 6.2 模块开发规则
- **插件开发**：严格按照插件架构规范开发插件
- **接口实现**：确保插件实现所有必要的接口
- **依赖管理**：插件应最小化依赖，避免与其他插件冲突
- **版本控制**：插件应包含版本信息，支持版本升级

### 6.3 一致性保证
- **设计遵循**：严格遵循技术设计文档中的设计
- **规则执行**：确保所有代码都遵循本规则文档
- **代码审查**：生成的代码应通过代码审查流程
- **测试验证**：生成的代码应通过所有测试

## 7. 变更管理

### 7.1 需求变更
- **变更评估**：评估需求变更对系统的影响
- **设计更新**：根据变更更新技术设计文档
- **代码修改**：按照更新后的设计修改代码
- **测试验证**：确保变更不会破坏现有功能

### 7.2 技术债务
- **债务识别**：定期识别技术债务
- **优先级排序**：根据影响程度排序技术债务
- **债务偿还**：在适当的时机偿还技术债务
- **预防措施**：采取措施预防技术债务的产生

## 8. 结论

本开发规则文档旨在确保上海中考择校系统开发过程中的确定性和一致性。所有参与开发的人员，包括AI，都应严格遵循本规则，以保证系统的质量、可维护性和用户体验。

规则文档将根据项目的发展和需求的变化进行定期更新，确保其与项目的实际情况保持一致。