## 1. 变更概览

本次变更针对目标页（TargetsPage）模块进行需求迭代，主要包括学生画像信息完善、模考概率计算逻辑优化以及目标学校列表样式与筛选页保持一致。

## 2. 变更内容

### 2.1 学生画像增加稳定分数、上限分、下限分

**现状分析**：
- 目标页的学生画像目前只显示所在区和当前初中信息
- 筛选页的学生画像已经包含稳定分数、上限分、下限分字段
- 后端API和类型定义已经支持这些字段

**变更需求**：
- 在目标页的学生画像中增加稳定分数、上限分、下限分显示
- 保持与筛选页学生画像的信息结构一致

### 2.2 模考概率改成基于学生画像的分数逻辑

**现状分析**：
- 目标页当前的模考概率基于历史成绩分布估算
- 筛选页的推荐度基于学生画像的分数逻辑
- 两者的计算逻辑不一致

**变更需求**：
- 将目标页的模考概率计算逻辑改为复用筛选页的"推荐学校池统计逻辑"
- 基于学生画像的分数信息进行计算
- 更新概率显示的文案说明

### 2.3 目标学校列表与筛选页推荐学校池保持一致

**现状分析**：
- 目标页和筛选页的学校卡片内容和样式存在差异
- 目标页的概率显示包含具体百分比，筛选页只显示等级
- 两者的操作按钮不同

**变更需求**：
- 目标学校列表的学校卡片内容、样式和概率显示与筛选页推荐学校池保持一致
- 操作按钮维持不变，仍然是“详情”和“删除”
- 移除目标页特有的概率进度条

## 3. 技术设计方案

### 3.1 前端变更

#### 3.1.1 学生画像组件修改

**文件**：`src/features/targets/components/ProfileSummarySection.tsx`

**变更内容**：
- 扩展学生画像显示区域，增加稳定分数、上限分、下限分显示
- 从 `studentProfile` 中获取分数信息并展示
- 保持与筛选页学生画像的样式一致

#### 3.1.2 目标学校列表组件修改

**文件**：`src/features/targets/components/TargetsListSection.tsx`

**变更内容**：
- 修改学校卡片的概率显示样式，与筛选页保持一致
- 移除概率进度条
- 更新概率显示的文案说明，改为“推荐度基于学生画像”
- 保持操作按钮不变（仍然是“详情”和“删除”）

### 3.2 后端变更

**文件**：`app/services/targets_service.py`

**变更内容**：
- 目标学校的概率计算逻辑复用筛选页的"推荐学校池统计逻辑"
- 基于学生画像的分数信息进行计算
- 确保返回的概率数据结构与前端期望一致

### 3.3 API设计

**现有API**：
- `GET /api/v1/targets/schools` - 获取目标学校列表
- `GET /api/v1/student/profile` - 获取学生画像信息

**变更说明**：
- 无需新增API，只需修改现有API的返回数据结构和计算逻辑
- 确保 `targets/schools` API返回的学校数据包含基于学生画像计算的概率
- 确保 `student/profile` API返回完整的学生画像信息，包括分数字段

## 4. UI变更方案

### 4.1 学生画像区域

**变更前**：
- 只显示所在区和当前初中两个字段

**变更后**：
- 增加稳定分数、上限分、下限分三个字段
- 布局调整为网格布局，保持与筛选页一致的样式

### 4.2 学校卡片

**变更前**：
- 概率显示包含具体百分比（例如：“保 · 85%”）
- 包含概率进度条
- 文案说明为“模考概率基于历史成绩分布估算”

**变更后**：
- 概率显示只显示等级（例如：“保”）
- 移除概率进度条
- 文案说明改为“推荐度基于学生画像”
- 保持操作按钮不变

## 5. 实现注意事项

### 5.1 数据一致性
- 确保目标页和筛选页使用相同的学生画像数据
- 确保概率计算逻辑在两个页面保持一致

### 5.2 兼容性
- 保持现有API的向后兼容性
- 确保在学生画像数据不完整时的优雅降级处理

### 5.3 性能
- 优化概率计算逻辑，确保页面加载速度
- 合理使用缓存，减少重复计算

## 6. 测试计划

### 6.1 功能测试
- 验证学生画像显示完整的分数信息
- 验证目标学校列表的概率显示与筛选页一致
- 验证概率计算逻辑基于学生画像分数

### 6.2 兼容性测试
- 验证在不同设备和浏览器上的显示效果
- 验证在学生画像数据不完整时的显示

### 6.3 性能测试
- 验证页面加载速度
- 验证学校列表的渲染性能

## 7. 预期效果

通过本次变更，目标页将与筛选页保持一致的用户体验，学生画像信息更加完整，模考概率计算更加准确，目标学校列表的显示更加统一。