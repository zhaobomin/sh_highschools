# éœ€æ±‚å˜æ›´æ–‡æ¡£ï¼šå­¦æ ¡è¯¦æƒ…æ¨¡å— v1.3

## 1. å˜æ›´æ¦‚è§ˆ

- **æ¨¡å—åç§°**ï¼šå­¦æ ¡è¯¦æƒ…
- **å˜æ›´ç‰ˆæœ¬**ï¼šv1.3
- **å˜æ›´æ—¥æœŸ**ï¼š2026-02-03
- **å˜æ›´ç±»å‹**ï¼šåŠŸèƒ½æ–°å¢

## 2. å˜æ›´éœ€æ±‚

### 2.1 éœ€æ±‚åˆ—è¡¨

| åºå· | éœ€æ±‚æè¿°                                                                                   | ä¼˜å…ˆçº§ |
| ---- | ------------------------------------------------------------------------------------------ | ------ |
| 1    | åœ¨å­¦æ ¡è¯¦æƒ…é¡µï¼Œå•ç‹¬åŠ ä¸€ä¸ªå¯¹äºè¿™ä¸ªå­¦æ ¡çš„è¯„ä¼°ç»“æœå¡ç‰‡ï¼Œå¡ç‰‡å†…å®¹è·Ÿ"è¯„ä¼°é¡µ"ä¸­çš„å†…å®¹å®Œå…¨ä¿æŒä¸€è‡´ | é«˜     |

### 2.2 éœ€æ±‚èƒŒæ™¯

ä¸ºäº†è®©ç”¨æˆ·åœ¨æŸ¥çœ‹å­¦æ ¡è¯¦æƒ…æ—¶èƒ½å¤ŸåŒæ—¶äº†è§£è¯¥å­¦æ ¡çš„è¯„ä¼°ç»“æœï¼Œé¿å…ç”¨æˆ·åœ¨ä¸åŒé¡µé¢ä¹‹é—´åˆ‡æ¢ï¼Œæé«˜ç”¨æˆ·ä½“éªŒã€‚

## 3. ç°çŠ¶åˆ†æ

### 3.1 ç°æœ‰åŠŸèƒ½

- **å­¦æ ¡è¯¦æƒ…é¡µ**ï¼šåŒ…å«å­¦æ ¡ä»‹ç»ã€æ‹›ç”Ÿä¿¡æ¯ã€åˆ†æ•°çº¿ä¿¡æ¯å’Œå­¦æ ¡æ¦‚å†µç­‰æ¨¡å—
  - å­¦æ ¡ä»‹ç»ï¼šæ˜¾ç¤ºå­¦æ ¡åŸºæœ¬ä¿¡æ¯å’Œç‰¹è‰²
  - æ‹›ç”Ÿä¿¡æ¯ï¼šæ˜¾ç¤ºå­¦æ ¡æ‹›ç”Ÿè®¡åˆ’å’Œåé¢åˆ†é…
  - åˆ†æ•°çº¿ä¿¡æ¯ï¼šæ˜¾ç¤ºå­¦æ ¡è¿‘å¹´æ¥çš„å½•å–åˆ†æ•°çº¿
  - å­¦æ ¡æ¦‚å†µï¼šæ˜¾ç¤ºå­¦æ ¡ä¸å­¦ç”Ÿçš„åŒ¹é…æƒ…å†µ

- **è¯„ä¼°é¡µ**ï¼šåŒ…å«ç›®æ ‡å­¦æ ¡çš„è¯„ä¼°ç»“æœå¡ç‰‡
  - æ˜¾ç¤ºå„æ‹›ç”Ÿæ¸ é“ï¼ˆè‡ªæ‹›ã€åˆ°åŒºã€åˆ°æ ¡ã€ç»Ÿä¸€ï¼‰çš„åˆ†æ•°ã€åé¢ã€å·®è·å’ŒçŠ¶æ€
  - æ”¯æŒå•æ¨¡è€ƒå’Œå¤šæ¨¡è€ƒä¸¤ç§æƒ…å†µçš„ä¸åŒæ˜¾ç¤º
  - æä¾›çŠ¶æ€å›¾æ ‡ï¼ˆğŸŸ¢ã€ğŸŸ¡ã€ğŸ”´ï¼‰ç›´è§‚å±•ç¤ºå½•å–å¯èƒ½æ€§

### 3.2 ç°æœ‰ä»£ç ç»“æ„

- **å‰ç«¯**ï¼š
  - `src/features/schools/SchoolDetailPage.tsx`ï¼šå­¦æ ¡è¯¦æƒ…é¡µä¸»ç»„ä»¶
  - `src/features/eval/components/EvalTargetCard.tsx`ï¼šè¯„ä¼°ç»“æœå¡ç‰‡ç»„ä»¶
  - `src/lib/dataClient.ts`ï¼šAPIè°ƒç”¨å°è£…
  - `src/lib/types.ts`ï¼šæ•°æ®ç±»å‹å®šä¹‰

- **åç«¯**ï¼š
  - `app/api/v1/schools.py`ï¼šå­¦æ ¡ç›¸å…³API
  - `app/services/schools_service.py`ï¼šå­¦æ ¡ä¸šåŠ¡é€»è¾‘

### 3.3 ç°çŠ¶æµç¨‹å›¾

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant SchoolDetail as å­¦æ ¡è¯¦æƒ…é¡µ
    participant EvalPage as è¯„ä¼°é¡µ
    participant API as åç«¯API

    User->>SchoolDetail: è®¿é—®å­¦æ ¡è¯¦æƒ…é¡µ
    SchoolDetail->>API: è·å–å­¦æ ¡è¯¦æƒ…æ•°æ®
    API-->>SchoolDetail: è¿”å›å­¦æ ¡è¯¦æƒ…
    SchoolDetail-->>User: æ˜¾ç¤ºå­¦æ ¡è¯¦æƒ…

    User->>EvalPage: è®¿é—®è¯„ä¼°é¡µ
    EvalPage->>API: è·å–è¯„ä¼°ç»“æœæ•°æ®
    API-->>EvalPage: è¿”å›è¯„ä¼°ç»“æœ
    EvalPage-->>User: æ˜¾ç¤ºè¯„ä¼°ç»“æœå¡ç‰‡
```

## 4. å˜æ›´æ–¹æ¡ˆ

### 4.1 å‰ç«¯å˜æ›´

1. **åœ¨å­¦æ ¡è¯¦æƒ…é¡µä¸­å¼•å…¥è¯„ä¼°ç»“æœå¡ç‰‡ç»„ä»¶**
   - å¤ç”¨ç°æœ‰çš„ `EvalTargetCard` ç»„ä»¶
   - æ·»åŠ è·å–å•ä¸ªå­¦æ ¡è¯„ä¼°ç»“æœçš„APIè°ƒç”¨

2. **è°ƒæ•´é¡µé¢å¸ƒå±€**
   - åœ¨å­¦æ ¡æ¦‚å†µæ¨¡å—ä¹‹åæ·»åŠ è¯„ä¼°ç»“æœå¡ç‰‡
   - ä¿æŒé¡µé¢æ•´ä½“é£æ ¼ä¸€è‡´

3. **çŠ¶æ€ç®¡ç†**
   - ä½¿ç”¨React Queryç®¡ç†è¯„ä¼°ç»“æœæ•°æ®çš„ç¼“å­˜å’ŒåŠ è½½çŠ¶æ€
   - å¤„ç†è¯„ä¼°ç»“æœçš„åŠ è½½å’Œé”™è¯¯çŠ¶æ€

### 4.2 åç«¯å˜æ›´

1. **æ–°å¢APIæ¥å£**
   - æ–°å¢ `/schools/{schoolId}/evaluation` æ¥å£
   - è¿”å›å•ä¸ªå­¦æ ¡çš„è¯„ä¼°ç»“æœï¼Œæ ¼å¼ä¸ç°æœ‰è¯„ä¼°æ¥å£ä¸€è‡´

2. **æ•°æ®å¤„ç†**
   - å¤ç”¨ç°æœ‰çš„è¯„ä¼°é€»è¾‘ï¼Œé’ˆå¯¹å•ä¸ªå­¦æ ¡è¿›è¡Œè¯„ä¼°
   - ç¡®ä¿è¯„ä¼°ç»“æœä¸è¯„ä¼°é¡µä¸­çš„è®¡ç®—é€»è¾‘ä¸€è‡´

### 4.3 å˜æ›´åæµç¨‹å›¾

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant SchoolDetail as å­¦æ ¡è¯¦æƒ…é¡µ
    participant API as åç«¯API

    User->>SchoolDetail: è®¿é—®å­¦æ ¡è¯¦æƒ…é¡µ
    SchoolDetail->>API: è·å–å­¦æ ¡è¯¦æƒ…æ•°æ®
    API-->>SchoolDetail: è¿”å›å­¦æ ¡è¯¦æƒ…
    SchoolDetail->>API: è·å–å­¦æ ¡è¯„ä¼°ç»“æœ
    API-->>SchoolDetail: è¿”å›è¯„ä¼°ç»“æœ
    SchoolDetail-->>User: æ˜¾ç¤ºå­¦æ ¡è¯¦æƒ…å’Œè¯„ä¼°ç»“æœå¡ç‰‡
```

### 4.4 ç°çŠ¶ä¸ä¿®æ”¹æ–¹æ¡ˆå¯¹æ¯”

| æ¨¡å—         | ç°çŠ¶                                         | ä¿®æ”¹æ–¹æ¡ˆ                                 | å½±å“èŒƒå›´              |
| ------------ | -------------------------------------------- | ---------------------------------------- | --------------------- |
| å­¦æ ¡è¯¦æƒ…é¡µ   | åŒ…å«å­¦æ ¡ä»‹ç»ã€æ‹›ç”Ÿä¿¡æ¯ã€åˆ†æ•°çº¿ä¿¡æ¯å’Œå­¦æ ¡æ¦‚å†µ | æ·»åŠ è¯„ä¼°ç»“æœå¡ç‰‡ï¼Œæ˜¾ç¤ºä¸è¯„ä¼°é¡µä¸€è‡´çš„å†…å®¹ | å‰ç«¯é¡µé¢å¸ƒå±€å’ŒAPIè°ƒç”¨ |
| è¯„ä¼°ç»“æœå¡ç‰‡ | ä»…åœ¨è¯„ä¼°é¡µä¸­æ˜¾ç¤º                             | åŒæ—¶åœ¨å­¦æ ¡è¯¦æƒ…é¡µä¸­æ˜¾ç¤º                   | ç»„ä»¶å¤ç”¨              |
| åç«¯API      | æä¾›æ‰¹é‡è¯„ä¼°ç»“æœæ¥å£                         | æ–°å¢å•ä¸ªå­¦æ ¡è¯„ä¼°ç»“æœæ¥å£                 | åç«¯è·¯ç”±å’Œä¸šåŠ¡é€»è¾‘    |
| æ•°æ®æ¨¡å‹     | ç°æœ‰æ•°æ®æ¨¡å‹æ»¡è¶³éœ€æ±‚                         | æ— éœ€ä¿®æ”¹æ•°æ®æ¨¡å‹                         | æ— å½±å“                |



## 5. æŠ€æœ¯è®¾è®¡

### 5.1 å‰ç«¯è®¾è®¡

#### 5.1.1 ç»„ä»¶å¤ç”¨
- **å¤ç”¨ `EvalTargetCard` ç»„ä»¶**ï¼šç›´æ¥ä½¿ç”¨è¯„ä¼°é¡µä¸­ç°æœ‰çš„è¯„ä¼°ç»“æœå¡ç‰‡ç»„ä»¶
- **ç»„ä»¶é€‚é…**ï¼šç¡®ä¿ç»„ä»¶èƒ½å¤Ÿåœ¨å­¦æ ¡è¯¦æƒ…é¡µä¸­æ­£å¸¸æ˜¾ç¤ºï¼Œä¿æŒä¸è¯„ä¼°é¡µä¸€è‡´çš„æ ·å¼å’ŒåŠŸèƒ½

#### 5.1.2 APIè°ƒç”¨
- **æ–°å¢APIå‡½æ•°**ï¼šåœ¨ `dataClient.ts` ä¸­æ·»åŠ  `getSchoolEvaluation` å‡½æ•°
- **APIè·¯å¾„**ï¼š`/schools/{schoolId}/evaluation`
- **æ•°æ®ç±»å‹**ï¼šä½¿ç”¨ç°æœ‰çš„ `TargetEvaluationResponse` ç±»å‹

#### 5.1.3 çŠ¶æ€ç®¡ç†
- **ä½¿ç”¨React Query**ï¼šæ·»åŠ æ–°çš„æŸ¥è¯¢é”® `['schools:evaluation', schoolId]`
- **åŠ è½½çŠ¶æ€**ï¼šæ·»åŠ è¯„ä¼°ç»“æœçš„åŠ è½½çŠ¶æ€å¤„ç†
- **é”™è¯¯çŠ¶æ€**ï¼šæ·»åŠ è¯„ä¼°ç»“æœçš„é”™è¯¯çŠ¶æ€å¤„ç†
- **ç¼“å­˜ç­–ç•¥**ï¼šä¸å…¶ä»–APIè°ƒç”¨ä¿æŒä¸€è‡´çš„ç¼“å­˜ç­–ç•¥

#### 5.1.4 å¸ƒå±€è°ƒæ•´
- **ä½ç½®**ï¼šåœ¨å­¦æ ¡æ¦‚å†µæ¨¡å—ä¹‹åæ·»åŠ è¯„ä¼°ç»“æœå¡ç‰‡
- **æ ·å¼**ï¼šä¿æŒä¸é¡µé¢å…¶ä»–æ¨¡å—ä¸€è‡´çš„é—´è·å’Œæ ·å¼
- **å“åº”å¼**ï¼šç¡®ä¿åœ¨ä¸åŒå±å¹•å°ºå¯¸ä¸‹æ­£å¸¸æ˜¾ç¤º

### 5.2 åç«¯è®¾è®¡

#### 5.2.1 APIè®¾è®¡
- **è·¯ç”±**ï¼š`GET /schools/{schoolId}/evaluation`
- **å‚æ•°**ï¼š
  - `schoolId`ï¼šå­¦æ ¡IDï¼ˆè·¯å¾„å‚æ•°ï¼‰
- **å“åº”**ï¼š
  - æˆåŠŸï¼š`200 OK`ï¼Œè¿”å›å•ä¸ªå­¦æ ¡çš„è¯„ä¼°ç»“æœ
  - å¤±è´¥ï¼š`404 Not Found`ï¼Œå¦‚æœå­¦æ ¡ä¸å­˜åœ¨
  - å¤±è´¥ï¼š`500 Internal Server Error`ï¼Œå¦‚æœè¯„ä¼°è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯

#### 5.2.2 æ•°æ®å¤„ç†
- **å¤ç”¨è¯„ä¼°é€»è¾‘**ï¼šä½¿ç”¨ç°æœ‰çš„è¯„ä¼°æœåŠ¡é€»è¾‘
- **å•å­¦æ ¡è¯„ä¼°**ï¼šé’ˆå¯¹æŒ‡å®šçš„å•ä¸ªå­¦æ ¡è¿›è¡Œè¯„ä¼°
- **æ•°æ®æ ¼å¼**ï¼šè¿”å›ä¸æ‰¹é‡è¯„ä¼°æ¥å£ä¸€è‡´çš„æ•°æ®æ ¼å¼

#### 5.2.3 æ€§èƒ½è€ƒè™‘
- **ç¼“å­˜**ï¼šè€ƒè™‘å¯¹è¯„ä¼°ç»“æœè¿›è¡Œç¼“å­˜ï¼Œå‡å°‘é‡å¤è®¡ç®—
- **å¼‚æ­¥å¤„ç†**ï¼šå¯¹äºå¤æ‚çš„è¯„ä¼°è®¡ç®—ï¼Œè€ƒè™‘ä½¿ç”¨å¼‚æ­¥å¤„ç†

### 5.3 æ•°æ®ç»“æ„

#### 5.3.1 å‰ç«¯æ•°æ®ç»“æ„
```typescript
// è¯„ä¼°ç»“æœå“åº”ç±»å‹
interface TargetEvaluationResponse {
  profile: TargetEvaluationProfile;
  model: TargetEvaluationModel;
  targets: TargetEvaluationSchool[];
}

// å­¦æ ¡è¯„ä¼°ç»“æœç±»å‹
interface TargetEvaluationSchool {
  id: string;
  name: string;
  district: District;
  type: HighSchoolType;
  fullType?: string;
  channels: {
    autonomous: TargetEvaluationChannel;
    district: TargetEvaluationChannel;
    school: TargetEvaluationChannel;
    unified: TargetEvaluationChannel;
  };
  overall: {
    level: 'high' | 'mid' | 'low' | 'na';
  };
}
```

#### 5.3.2 åç«¯æ•°æ®ç»“æ„
- **è¾“å…¥**ï¼šå­¦æ ¡ID
- **è¾“å‡º**ï¼šä¸å‰ç«¯ `TargetEvaluationResponse` å¯¹åº”çš„åç«¯æ•°æ®ç»“æ„
- **ä¸­é—´æ•°æ®**ï¼šå­¦ç”Ÿæ¡£æ¡ˆã€æ¨¡è€ƒæˆç»©ã€å­¦æ ¡åˆ†æ•°çº¿ç­‰

## 6. å®ç°è®¡åˆ’

### 6.1 å‰ç«¯å®ç°

#### 6.1.1 æ­¥éª¤1ï¼šæ·»åŠ APIè°ƒç”¨å‡½æ•°
- **æ–‡ä»¶**ï¼š`src/lib/dataClient.ts`
- **ä¿®æ”¹**ï¼šæ·»åŠ  `getSchoolEvaluation` å‡½æ•°
- **å†…å®¹**ï¼š
  ```typescript
  export async function getSchoolEvaluation(schoolId: string): Promise<ApiResponse<TargetEvaluationResponse>> {
    return fallback(
      () => fetcher.get(`/schools/${encodeURIComponent(schoolId)}/evaluation`),
      () => Promise.resolve({
        data: {
          profile: {
            district: null,
            middleSchoolId: null,
            stableScore: null,
            highScore: null,
            lowScore: null,
          },
          model: { mean: null, std: null, count: 0, source: 'none' },
          targets: [],
        },
      })
    );
  }
  ```

#### 6.1.2 æ­¥éª¤2ï¼šä¿®æ”¹å­¦æ ¡è¯¦æƒ…é¡µç»„ä»¶
- **æ–‡ä»¶**ï¼š`src/features/schools/SchoolDetailPage.tsx`
- **ä¿®æ”¹**ï¼š
  1. å¯¼å…¥ `EvalTargetCard` ç»„ä»¶
  2. å¯¼å…¥ `getSchoolEvaluation` å‡½æ•°
  3. æ·»åŠ è¯„ä¼°ç»“æœæŸ¥è¯¢
  4. åœ¨é¡µé¢ä¸­æ·»åŠ è¯„ä¼°ç»“æœå¡ç‰‡
- **å†…å®¹**ï¼š
  ```typescript
  // å¯¼å…¥ç»„ä»¶å’Œå‡½æ•°
  import EvalTargetCard from '@/features/eval/components/EvalTargetCard';
  import { getSchoolEvaluation } from '@/lib/dataClient';
  
  // æ·»åŠ è¯„ä¼°ç»“æœæŸ¥è¯¢
  const { data: evalResp } = useQuery({
    queryKey: ['schools:evaluation', id],
    queryFn: () => getSchoolEvaluation(id || ''),
    enabled: !!id,
  });
  
  // æå–è¯„ä¼°ç»“æœ
  const evaluation = evalResp?.data ?? null;
  const model = evaluation?.model ?? { mean: null, std: null, count: 0, source: 'none' };
  const evalSchool = evaluation?.targets?.[0] ?? null;
  
  // åœ¨é¡µé¢ä¸­æ·»åŠ è¯„ä¼°ç»“æœå¡ç‰‡
  {evalSchool && (
    <EvalTargetCard
      school={evalSchool}
      model={model}
      t={t}
    />
  )}
  ```

#### 6.1.3 æ­¥éª¤3ï¼šè°ƒæ•´é¡µé¢å¸ƒå±€å’Œæ ·å¼
- **æ–‡ä»¶**ï¼š`src/features/schools/SchoolDetailPage.tsx`
- **ä¿®æ”¹**ï¼šç¡®ä¿è¯„ä¼°ç»“æœå¡ç‰‡ä¸é¡µé¢å…¶ä»–æ¨¡å—ä¿æŒä¸€è‡´çš„é—´è·å’Œæ ·å¼

### 6.2 åç«¯å®ç°

#### 6.2.1 æ­¥éª¤1ï¼šæ·»åŠ APIæ¥å£
- **æ–‡ä»¶**ï¼š`app/api/v1/schools.py`
- **ä¿®æ”¹**ï¼šæ·»åŠ æ–°çš„è·¯ç”±å’Œå¤„ç†å‡½æ•°
- **å†…å®¹**ï¼š
  ```python
  @router.get("/{school_id}/evaluation", response_model=ApiResponse[TargetEvaluationResponse])
  async def get_school_evaluation(
      school_id: str,
      db: Session = Depends(get_db),
      current_user: User = Depends(get_current_user),
  ):
      """è·å–å•ä¸ªå­¦æ ¡çš„è¯„ä¼°ç»“æœ"""
      try:
          evaluation = await schools_service.evaluate_single_school(
              db=db,
              user_id=current_user.id,
              school_id=school_id,
          )
          return {"data": evaluation}
      except SchoolNotFoundError:
          raise HTTPException(status_code=404, detail="School not found")
      except Exception as e:
          logger.error(f"Error evaluating school: {e}")
          raise HTTPException(status_code=500, detail="Internal server error")
  ```

#### 6.2.2 æ­¥éª¤2ï¼šå®ç°å•å­¦æ ¡è¯„ä¼°é€»è¾‘
- **æ–‡ä»¶**ï¼š`app/services/schools_service.py`
- **ä¿®æ”¹**ï¼šæ·»åŠ  `evaluate_single_school` å‡½æ•°
- **å†…å®¹**ï¼š
  ```python
  async def evaluate_single_school(
      db: Session,
      user_id: UUID,
      school_id: str,
  ) -> TargetEvaluationResponse:
      """è¯„ä¼°å•ä¸ªå­¦æ ¡"""
      # è·å–å­¦ç”Ÿæ¡£æ¡ˆ
      profile = await get_student_profile(db, user_id)
      
      # è·å–å­¦æ ¡ä¿¡æ¯
      school = await get_school_by_id(db, school_id)
      if not school:
          raise SchoolNotFoundError()
      
      # è·å–æ¨¡è€ƒæˆç»©
      mock_exams = await get_user_mock_exams(db, user_id)
      
      # è®¡ç®—è¯„ä¼°æ¨¡å‹
      model = calculate_evaluation_model(mock_exams)
      
      # è¯„ä¼°å­¦æ ¡
      evaluated_school = await evaluate_school(school, profile, model)
      
      # æ„å»ºå“åº”
      return TargetEvaluationResponse(
          profile=profile,
          model=model,
          targets=[evaluated_school],
      )
  ```

#### 6.2.3 æ­¥éª¤3ï¼šæµ‹è¯•å’ŒéªŒè¯
- **æµ‹è¯•**ï¼šç¡®ä¿APIæ¥å£èƒ½å¤Ÿæ­£å¸¸è¿”å›è¯„ä¼°ç»“æœ
- **éªŒè¯**ï¼šç¡®ä¿è¯„ä¼°ç»“æœä¸è¯„ä¼°é¡µä¸­çš„å†…å®¹ä¸€è‡´
- **æ€§èƒ½**ï¼šç¡®ä¿APIå“åº”æ—¶é—´åˆç†

## 7. æµ‹è¯•è®¡åˆ’

- **åŠŸèƒ½æµ‹è¯•**ï¼šéªŒè¯è¯„ä¼°ç»“æœå¡ç‰‡åœ¨å­¦æ ¡è¯¦æƒ…é¡µä¸­æ­£ç¡®æ˜¾ç¤º
- **æ•°æ®ä¸€è‡´æ€§æµ‹è¯•**ï¼šéªŒè¯è¯„ä¼°ç»“æœä¸è¯„ä¼°é¡µä¸­çš„å†…å®¹ä¸€è‡´
- **å¸ƒå±€æµ‹è¯•**ï¼šéªŒè¯é¡µé¢å¸ƒå±€å’Œæ ·å¼åœ¨ä¸åŒå±å¹•å°ºå¯¸ä¸‹çš„é€‚é…
- **çŠ¶æ€æµ‹è¯•**ï¼šéªŒè¯è¯„ä¼°ç»“æœçš„åŠ è½½çŠ¶æ€å’Œé”™è¯¯çŠ¶æ€å¤„ç†
- **æ€§èƒ½æµ‹è¯•**ï¼šéªŒè¯æ·»åŠ è¯„ä¼°ç»“æœå¡ç‰‡åé¡µé¢åŠ è½½é€Ÿåº¦æ˜¯å¦å—åˆ°å½±å“

## 8. é£é™©è¯„ä¼°

- **APIä¾èµ–**ï¼šå¦‚æœåç«¯APIæœªå°±ç»ªï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨mockæ•°æ®
- **æ•°æ®ä¸€è‡´æ€§**ï¼šéœ€è¦ç¡®ä¿è¯„ä¼°ç»“æœä¸è¯„ä¼°é¡µä¸­çš„è®¡ç®—é€»è¾‘ä¸€è‡´
- **æ€§èƒ½å½±å“**ï¼šæ·»åŠ é¢å¤–çš„APIè°ƒç”¨å¯èƒ½ä¼šå½±å“é¡µé¢åŠ è½½é€Ÿåº¦
- **å…¼å®¹æ€§**ï¼šéœ€è¦ç¡®ä¿åœ¨ä¸åŒæµè§ˆå™¨å’Œè®¾å¤‡ä¸Šçš„å…¼å®¹æ€§

## 9. å½±å“èŒƒå›´

- **å‰ç«¯**ï¼š
  - ä¿®æ”¹ `src/features/schools/SchoolDetailPage.tsx`ï¼šæ·»åŠ è¯„ä¼°ç»“æœå¡ç‰‡
  - ä¿®æ”¹ `src/lib/dataClient.ts`ï¼šæ·»åŠ è·å–å•ä¸ªå­¦æ ¡è¯„ä¼°ç»“æœçš„å‡½æ•°
- **åç«¯**ï¼š
  - ä¿®æ”¹ `app/api/v1/schools.py`ï¼šæ·»åŠ æ–°çš„APIæ¥å£
  - ä¿®æ”¹ `app/services/schools_service.py`ï¼šæ·»åŠ å•å­¦æ ¡è¯„ä¼°é€»è¾‘
- **å…¶ä»–**ï¼šä¸å½±å“å…¶ä»–é¡µé¢åŠŸèƒ½å’Œæ•°æ®æ¨¡å‹

## 10. UIç»„ä»¶ä¿®æ”¹æ–¹æ¡ˆ

### 10.1 ç»„ä»¶å¯¼å…¥å’Œä½¿ç”¨

- **å¯¼å…¥ç»„ä»¶**ï¼šåœ¨ `SchoolDetailPage.tsx` ä¸­å¯¼å…¥ `EvalTargetCard` ç»„ä»¶
- **å¯¼å…¥å‡½æ•°**ï¼šåœ¨ `SchoolDetailPage.tsx` ä¸­å¯¼å…¥ `getSchoolEvaluation` å‡½æ•°
- **å¯¼å…¥ç±»å‹**ï¼šç¡®ä¿å¯¼å…¥å¿…è¦çš„ç±»å‹å®šä¹‰

### 10.2 å¸ƒå±€è°ƒæ•´

- **ä½ç½®**ï¼šåœ¨å­¦æ ¡æ¦‚å†µæ¨¡å—ä¹‹åæ·»åŠ è¯„ä¼°ç»“æœå¡ç‰‡
- **é—´è·**ï¼šä¿æŒä¸é¡µé¢å…¶ä»–æ¨¡å—ä¸€è‡´çš„é—´è·ï¼ˆä½¿ç”¨ `space-y-4` ç±»ï¼‰
- **å®¹å™¨**ï¼šä½¿ç”¨ä¸å…¶ä»–æ¨¡å—ç›¸åŒçš„å®¹å™¨ç±»

### 10.3 çŠ¶æ€å¤„ç†

- **åŠ è½½çŠ¶æ€**ï¼šåœ¨è¯„ä¼°ç»“æœåŠ è½½è¿‡ç¨‹ä¸­æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨
- **é”™è¯¯çŠ¶æ€**ï¼šåœ¨è¯„ä¼°ç»“æœè·å–å¤±è´¥æ—¶æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
- **ç©ºçŠ¶æ€**ï¼šåœ¨è¯„ä¼°ç»“æœä¸ºç©ºæ—¶æ˜¾ç¤ºæç¤ºä¿¡æ¯

### 10.4 å“åº”å¼è®¾è®¡

- **æ¡Œé¢ç«¯**ï¼šå®Œæ•´æ˜¾ç¤ºè¯„ä¼°ç»“æœå¡ç‰‡çš„æ‰€æœ‰åˆ—
- **å¹³æ¿ç«¯**ï¼šä¿æŒå®Œæ•´æ˜¾ç¤ºï¼Œå¯èƒ½éœ€è¦è°ƒæ•´åˆ—å®½
- **ç§»åŠ¨ç«¯**ï¼šç¡®ä¿è¡¨æ ¼å†…å®¹èƒ½å¤Ÿæ¨ªå‘æ»šåŠ¨ï¼Œæˆ–è€…åœ¨å°å±å¹•ä¸Šè‡ªåŠ¨è°ƒæ•´å¸ƒå±€

### 10.5 è§†è§‰ä¸€è‡´æ€§

- **é¢œè‰²**ï¼šä½¿ç”¨ä¸è¯„ä¼°é¡µç›¸åŒçš„é¢œè‰²æ–¹æ¡ˆ
- **å­—ä½“**ï¼šä½¿ç”¨ä¸é¡µé¢å…¶ä»–æ¨¡å—ç›¸åŒçš„å­—ä½“å’Œå­—å·
- **å›¾æ ‡**ï¼šä½¿ç”¨ä¸è¯„ä¼°é¡µç›¸åŒçš„çŠ¶æ€å›¾æ ‡ï¼ˆğŸŸ¢ã€ğŸŸ¡ã€ğŸ”´ï¼‰
- **è¾¹æ¡†**ï¼šä½¿ç”¨ä¸é¡µé¢å…¶ä»–æ¨¡å—ç›¸åŒçš„è¾¹æ¡†æ ·å¼

### 10.6 å…·ä½“å®ç°ç¤ºä¾‹

```typescript
// ä¿®æ”¹åçš„ SchoolDetailPage.tsx éƒ¨åˆ†ä»£ç 
import EvalTargetCard from '@/features/eval/components/EvalTargetCard';
import { getSchoolEvaluation } from '@/lib/dataClient';
import { useTranslation } from 'react-i18next';

// åœ¨ç»„ä»¶ä¸­æ·»åŠ 
const { t } = useTranslation();

// æ·»åŠ è¯„ä¼°ç»“æœæŸ¥è¯¢
const { data: evalResp, isLoading: isEvalLoading, error: evalError } = useQuery({
  queryKey: ['schools:evaluation', id],
  queryFn: () => getSchoolEvaluation(id || ''),
  enabled: !!id,
});

// æå–è¯„ä¼°ç»“æœ
const evaluation = evalResp?.data ?? null;
const model = evaluation?.model ?? { mean: null, std: null, count: 0, source: 'none' };
const evalSchool = evaluation?.targets?.[0] ?? null;

// åœ¨é¡µé¢ä¸­æ·»åŠ è¯„ä¼°ç»“æœå¡ç‰‡
<StateContainer className="pt-[env(safe-area-inset-top)] pb-[env(safe-area-inset-bottom)] space-y-4">
  <SchoolIntroductionSection school={school} />
  <SchoolEnrollmentSection enrollment={school.enrollment} />
  <SchoolScoresSection scores={school.scores} year={school.enrollment?.year ?? null} />
  <SchoolProfileSection
    district={studentProfile?.district}
    middleSchoolName={middleSchoolName}
    stableScore={studentProfile?.stable_score}
    highScore={studentProfile?.high_score}
    lowScore={studentProfile?.low_score}
    recommendedSchool={recommendedSchool}
  />
  
  {/* è¯„ä¼°ç»“æœå¡ç‰‡ */}
  {isEvalLoading ? (
    <div className="p-4 bg-card rounded-lg border border-border">
      <div className="flex justify-center items-center h-20">
        <div className="text-muted-foreground">{t('ui.loading')}...</div>
      </div>
    </div>
  ) : evalError ? (
    <div className="p-4 bg-card rounded-lg border border-border">
      <div className="text-destructive text-center">{t('ui.error.loadFailed')}</div>
    </div>
  ) : evalSchool ? (
    <EvalTargetCard
      school={evalSchool}
      model={model}
      t={t}
    />
  ) : (
    <div className="p-4 bg-card rounded-lg border border-border">
      <div className="text-muted-foreground text-center">{t('ui.eval.hint.noEvaluation')}</div>
    </div>
  )}
</StateContainer>
```

### 10.7 APIæ¥å£è®¾è®¡

#### 10.7.1 æ¥å£è·¯å¾„
- `GET /schools/{schoolId}/evaluation`

#### 10.7.2 è¯·æ±‚å‚æ•°
| å‚æ•°å     | ç±»å‹   | ä½ç½® | æè¿°   |
| ---------- | ------ | ---- | ------ |
| `schoolId` | string | è·¯å¾„ | å­¦æ ¡ID |

#### 10.7.3 å“åº”æ ¼å¼

```json
{
  "data": {
    "profile": {
      "district": "é»„æµ¦",
      "middleSchoolId": "123",
      "stableScore": 680,
      "highScore": 700,
      "lowScore": 660
    },
    "model": {
      "mean": 680,
      "std": 15,
      "count": 3,
      "source": "mocks"
    },
    "targets": [
      {
        "id": "123",
        "name": "ä¸Šæµ·ä¸­å­¦",
        "district": "å¾æ±‡",
        "type": "å¸‚é‡ç‚¹",
        "channels": {
          "autonomous": {
            "score": 700,
            "quota": 50,
            "gap": 20,
            "status": "green"
          },
          "district": {
            "score": 690,
            "quota": 30,
            "gap": 10,
            "status": "green"
          },
          "school": {
            "score": 685,
            "quota": 20,
            "gap": 5,
            "status": "yellow"
          },
          "unified": {
            "score": 680,
            "quota": 100,
            "gap": 0,
            "status": "yellow"
          }
        },
        "overall": {
          "level": "high"
        }
      }
    ]
  }
}
```

#### 10.7.4 é”™è¯¯å“åº”

- **404 Not Found**ï¼š
  ```json
  {
    "detail": "School not found"
  }
  ```

- **500 Internal Server Error**ï¼š
  ```json
  {
    "detail": "Internal server error"
  }
  ```
